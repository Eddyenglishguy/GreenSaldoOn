<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>GreenSaldo — Controle simples do seu dinheiro</title>
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <meta name="description" content="GreenSaldo — um site inicial elegante para controlar saldo e pequenas despesas.">
  <style>
    :root{
      --bg:#f5f7fb;
      --card:#ffffff;
      --muted:#64748b;
      --accent:#16a34a; /* verde */
      --accent-2:#059669;
      --glass: rgba(255,255,255,0.7);
      --shadow: 0 8px 24px rgba(18,38,61,0.08);
      --radius:16px;
      color-scheme: light;
      font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    [data-theme='dark']{
      --bg:#071022;
      --card:#072033;
      --muted:#9aa9bf;
      --accent:#34d399;
      --accent-2:#10b981;
      --glass: rgba(255,255,255,0.03);
      --shadow: 0 8px 30px rgba(0,0,0,0.6);
      color-scheme: dark;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(22,163,74,0.06), transparent), radial-gradient(900px 500px at 90% 90%, rgba(6,95,70,0.04), transparent), var(--bg);
      padding:32px;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      gap:24px;
      font-size:16px;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .container{
      width:100%;
      max-width:1100px;
      display:grid;
      grid-template-columns: 360px 1fr;
      gap:24px;
      align-items:start;
    }

    /* SIDEBAR */
    .sidebar{
      position:sticky; top:32px;
      background: linear-gradient(180deg, var(--glass), rgba(255,255,255,0.02));
      border-radius:var(--radius);
      padding:20px;
      box-shadow:var(--shadow);
      border:1px solid rgba(255,255,255,0.04);
      min-height:420px;
      display:flex;
      flex-direction:column;
      gap:16px;
    }

    .brand{
      display:flex;gap:12px;align-items:center
    }
    .logo{
      width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;color:white;font-weight:700;box-shadow:0 6px 18px rgba(16,185,129,0.18);
    }
    .brand h1{font-size:18px;margin:0}
    .brand p{font-size:13px;margin:0;color:var(--muted)}

    .balance-card{
      background:var(--card);
      padding:14px;border-radius:12px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:8px
    }
    .balance-row{display:flex;justify-content:space-between;align-items:center}
    .amount{font-size:28px;font-weight:700}
    .sub{font-size:13px;color:var(--muted)}

    .actions{display:flex;gap:8px}
    .btn{background:var(--accent);color:white;padding:8px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:600}
    .btn.ghost{background:transparent;color:var(--muted);border:1px solid rgba(0,0,0,0.06)}

    nav{display:flex;flex-direction:column;gap:8px}
    .nav-item{display:flex;gap:10px;align-items:center;padding:10px;border-radius:10px;color:var(--muted);cursor:pointer}
    .nav-item:hover{background:rgba(0,0,0,0.03)}

    /* MAIN */
    main{min-height:420px}
    .topbar{display:flex;justify-content:space-between;align-items:center;gap:16px;margin-bottom:18px}
    .search{flex:1;display:flex;gap:8px;align-items:center}
    .search input{width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);background:transparent}

    .cards{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:18px}
    .card{background:var(--card);padding:16px;border-radius:12px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:8px}
    .card h3{margin:0}

    .transactions{background:var(--card);padding:16px;border-radius:12px;box-shadow:var(--shadow)}
    .tx{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px dashed rgba(0,0,0,0.04)}
    .tx:last-child{border-bottom:0}

    /* Chart */
    .chart-wrap{height:160px;padding:10px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.03), transparent)}

    footer{margin-top:18px;color:var(--muted);font-size:13px}

    /* Responsive */
    @media (max-width:920px){
      .container{grid-template-columns:1fr;}
      .cards{grid-template-columns:repeat(2,1fr)}
    }
    @media (max-width:600px){
      .cards{grid-template-columns:1fr}
      body{padding:16px}
    }

    /* small helpers */
    .muted{color:var(--muted)}
    .pill{background:rgba(0,0,0,0.04);padding:6px 10px;border-radius:999px;font-weight:600}

    /* modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.5);backdrop-filter:blur(4px);}
    .modal.open{display:flex}
    .modal-card{width:420px;background:var(--card);border-radius:12px;padding:18px;box-shadow:var(--shadow)}
    .form-row{display:flex;gap:8px}
    .form-row input, .form-row select{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)}

  </style>
</head>
<body>
  <div class="container" id="app">
    <aside class="sidebar" aria-label="Barra lateral">
      <div class="brand">
        <div class="logo">GS</div>
        <div>
          <h1>GreenSaldo</h1>
          <p class="muted">Controle simples e verde das suas finanças</p>
        </div>
      </div>

      <div class="balance-card" id="balanceCard">
        <div class="balance-row">
          <div>
            <div class="sub">Saldo disponível</div>
            <div class="amount" id="currentBalance">R$ 0,00</div>
          </div>
          <div class="actions">
            <button class="btn" id="addBtn">+ Nova</button>
            <button class="btn ghost" id="resetBtn">Reset</button>
          </div>
        </div>
        <div class="sub">Última atualização: <span id="lastUpdated">—</span></div>
      </div>

      <nav>
        <div class="nav-item"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 12h18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>Visão geral</div>
        <div class="nav-item"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 5v14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>Transações</div>
        <div class="nav-item"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M5 12h14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>Relatórios</div>
      </nav>

      <div style="flex:1"></div>
      <div style="display:flex;gap:8px;align-items:center;justify-content:space-between">
        <div class="muted">Tema</div>
        <label style="display:flex;gap:8px;align-items:center">
          <input type="checkbox" id="themeToggle"> <span class="muted">Escuro</span>
        </label>
      </div>
    </aside>

    <main>
      <div class="topbar">
        <div class="search">
          <input id="search" placeholder="Procurar transações, categorias..." aria-label="Buscar">
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <div class="pill" id="summaryCount">0 transações</div>
        </div>
      </div>

      <section class="cards">
        <div class="card">
          <h3>Resumo mensal</h3>
          <div class="muted">Receitas / Despesas</div>
          <div style="display:flex;gap:10px;align-items:center;margin-top:8px">
            <div style="flex:1"><strong id="income">R$ 0,00</strong><div class="muted">Receitas</div></div>
            <div style="flex:1"><strong id="expense">R$ 0,00</strong><div class="muted">Despesas</div></div>
          </div>
        </div>

        <div class="card chart-wrap">
          <h3 style="margin-top:0">Evolução</h3>
          <canvas id="chart" width="400" height="140" style="width:100%;height:100%"></canvas>
        </div>

        <div class="card">
          <h3>Atalhos</h3>
          <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
            <button class="btn" id="exportBtn">Exportar CSV</button>
            <button class="btn ghost" id="sampleBtn">Adicionar exemplos</button>
          </div>
        </div>
      </section>

      <section class="transactions" aria-label="Lista de transações">
        <h3>Transações recentes</h3>
        <div id="txList"></div>
        <footer>GreenSaldo • protótipo • Dados salvos no seu navegador</footer>
      </section>
    </main>
  </div>

  <!-- Modal Adicionar -->
  <div class="modal" id="modal">
    <div class="modal-card" role="dialog" aria-modal="true">
      <h3>Nova transação</h3>
      <div style="height:10px"></div>
      <div class="form-row">
        <select id="type"><option value="income">Receita</option><option value="expense">Despesa</option></select>
        <input id="amount" type="number" placeholder="Valor (ex: 50.00)" step="0.01">
      </div>
      <div style="height:8px"></div>
      <div class="form-row">
        <input id="title" placeholder="Descrição (ex: Mercado)">
        <input id="date" type="date">
      </div>
      <div style="height:12px"></div>
      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button class="btn ghost" id="cancelModal">Cancelar</button>
        <button class="btn" id="saveTx">Salvar</button>
      </div>
    </div>
  </div>

  <script>
    // -- Storage helpers
    const KEY = 'greenSaldo_v1';
    const state = {
      balance: 0,
      transactions: [],
      updated: null
    };

    function formatBRL(v){
      return v.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
    }

    function load(){
      try{
        const raw = localStorage.getItem(KEY);
        if(raw){
          const parsed = JSON.parse(raw);
          Object.assign(state, parsed);
        } else {
          // default sample balance
          state.balance = 0;
          state.transactions = [];
        }
      }catch(e){console.error(e)}
    }
    function save(){
      state.updated = new Date().toISOString();
      localStorage.setItem(KEY, JSON.stringify(state));
      render();
    }

    // -- UI refs
    const currentBalance = document.getElementById('currentBalance');
    const lastUpdated = document.getElementById('lastUpdated');
    const txList = document.getElementById('txList');
    const summaryCount = document.getElementById('summaryCount');
    const incomeEl = document.getElementById('income');
    const expenseEl = document.getElementById('expense');

    // -- Modal
    const modal = document.getElementById('modal');
    document.getElementById('addBtn').addEventListener('click', ()=> modal.classList.add('open'));
    document.getElementById('cancelModal').addEventListener('click', ()=> modal.classList.remove('open'));

    // -- Theme
    const themeToggle = document.getElementById('themeToggle');
    function applyTheme(pref){
      if(pref === 'dark') document.documentElement.setAttribute('data-theme','dark');
      else document.documentElement.removeAttribute('data-theme');
      themeToggle.checked = (pref === 'dark');
      localStorage.setItem('greenSaldo_theme', pref);
    }
    themeToggle.addEventListener('change', ()=> applyTheme(themeToggle.checked ? 'dark' : 'light'));
    (function(){
      const t = localStorage.getItem('greenSaldo_theme') || 'light';
      applyTheme(t);
    })();

    // -- Transaction logic
    function uid(){ return Math.random().toString(36).slice(2,9) }

    function addTransaction(tx){
      state.transactions.unshift(tx);
      recompute();
      save();
    }

    function recompute(){
      let bal = state.balance || 0;
      // compute monthly summary from transactions this month
      const now = new Date();
      const month = now.getMonth();
      const year = now.getFullYear();
      let income = 0, expense = 0;
      state.transactions.forEach(t=>{
        if(t.type === 'income') income += Number(t.amount);
        else expense += Number(t.amount);
      });
      // balance = starting balance + incomes - expenses
      bal = state.transactions.reduce((acc,t)=> acc + (t.type==='income'?Number(t.amount): -Number(t.amount)), 0);
      state.balance = bal;
      // write UI
      incomeEl.textContent = formatBRL(income);
      expenseEl.textContent = formatBRL(expense);
    }

    function render(){
      currentBalance.textContent = formatBRL(Number(state.balance) || 0);
      lastUpdated.textContent = state.updated ? new Date(state.updated).toLocaleString() : '—';
      summaryCount.textContent = `${state.transactions.length} transações`;

      // transactions list
      txList.innerHTML = '';
      state.transactions.forEach(t=>{
        const el = document.createElement('div'); el.className = 'tx';
        const left = document.createElement('div');
        left.innerHTML = `<div style=\"font-weight:700\">${t.title}</div><div class=\"muted\" style=\"font-size:13px\">${new Date(t.date).toLocaleDateString()}</div>`;
        const right = document.createElement('div');
        right.innerHTML = `<div style=\"text-align:right\">${t.type==='income'?'<span style=\\"color:var(--accent)\\">+':''}${formatBRL(Number(t.amount))}${t.type==='expense'?'<span style=\\"color:#ef4444;\\">':''}</div>`;
        el.appendChild(left); el.appendChild(right);
        txList.appendChild(el);
      });

      drawChart();
    }

    // -- Form save
    document.getElementById('saveTx').addEventListener('click', ()=>{
      const type = document.getElementById('type').value;
      const amount = Number(document.getElementById('amount').value);
      const title = document.getElementById('title').value || (type==='income'?'Recebido':'Gasto');
      const date = document.getElementById('date').value || new Date().toISOString().slice(0,10);
      if(!amount || amount <= 0){ alert('Informe um valor válido.'); return; }
      const tx = { id: uid(), type, amount: amount.toFixed(2), title, date };
      addTransaction(tx);
      document.getElementById('amount').value = '';
      document.getElementById('title').value = '';
      modal.classList.remove('open');
    });

    // -- Reset
    document.getElementById('resetBtn').addEventListener('click', ()=>{
      if(confirm('Quer mesmo apagar todos os dados locais de GreenSaldo?')){
        localStorage.removeItem(KEY);
        state.balance = 0; state.transactions = []; state.updated = null;
        render();
      }
    });

    // -- Sample data
    document.getElementById('sampleBtn').addEventListener('click', ()=>{
      const samples = [
        {id:uid(), type:'income', amount:'2500.00', title:'Salário', date: new Date().toISOString().slice(0,10)},
        {id:uid(), type:'expense', amount:'120.50', title:'Mercado', date: new Date().toISOString().slice(0,10)},
        {id:uid(), type:'expense', amount:'59.90', title:'Transporte', date: new Date().toISOString().slice(0,10)},
        {id:uid(), type:'expense', amount:'39.90', title:'Lazer', date: new Date().toISOString().slice(0,10)}
      ];
      state.transactions = samples.concat(state.transactions);
      recompute(); save();
    });

    // -- Export CSV
    document.getElementById('exportBtn').addEventListener('click', ()=>{
      const rows = ['id,type,amount,title,date'];
      state.transactions.forEach(t=> rows.push([t.id,t.type,t.amount,`"${t.title.replace(/\"/g,'\"') }"`,t.date].join(',')));
      const csv = rows.join('\n');
      const blob = new Blob([csv], {type:'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'greensaldo-transacoes.csv'; a.click(); URL.revokeObjectURL(url);
    });

    // -- Search filter
    document.getElementById('search').addEventListener('input', (e)=>{
      const q = e.target.value.toLowerCase();
      const items = Array.from(txList.children);
      items.forEach(it=>{
        const keep = it.textContent.toLowerCase().includes(q);
        it.style.display = keep ? '' : 'none';
      });
    });

    // -- Chart drawing (simple)
    function drawChart(){
      const canvas = document.getElementById('chart');
      const ctx = canvas.getContext('2d');
      const w = canvas.width = canvas.clientWidth * devicePixelRatio;
      const h = canvas.height = canvas.clientHeight * devicePixelRatio;
      ctx.clearRect(0,0,w,h);

      // build last 6 points by month totals
      const labels = [];
      const points = [];
      for(let i=5;i>=0;i--){
        const d = new Date(); d.setMonth(d.getMonth()-i);
        labels.push(d.toLocaleString('pt-BR',{month:'short'}));
        const month = d.getMonth(); const year = d.getFullYear();
        const total = state.transactions.reduce((acc,t)=>{
          const td = new Date(t.date);
          return (td.getMonth()===month && td.getFullYear()===year) ? acc + (t.type==='income'?Number(t.amount): -Number(t.amount)) : acc;
        },0);
        points.push(total);
      }

      // normalize
      const max = Math.max(...points, 10);
      const min = Math.min(...points, 0);
      const pad = 20*devicePixelRatio;

      // draw grid
      ctx.strokeStyle = 'rgba(0,0,0,0.04)'; ctx.lineWidth = 1;
      for(let i=0;i<4;i++){
        const y = pad + (h-2*pad)*(i/3);
        ctx.beginPath(); ctx.moveTo(pad,y); ctx.lineTo(w-pad,y); ctx.stroke();
      }

      // draw polyline
      ctx.beginPath();
      points.forEach((p,i)=>{
        const x = pad + (w-2*pad)*(i/(points.length-1));
        const y = pad + (h-2*pad)*(1 - (p - min)/(max - min||1));
        if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      });
      ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--accent-2') || '#059669';
      ctx.lineWidth = 3*devicePixelRatio; ctx.stroke();

      // draw points
      points.forEach((p,i)=>{
        const x = pad + (w-2*pad)*(i/(points.length-1));
        const y = pad + (h-2*pad)*(1 - (p - min)/(max - min||1));
        ctx.beginPath(); ctx.arc(x,y,4*devicePixelRatio,0,Math.PI*2); ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--accent') || '#16a34a'; ctx.fill();
      });

      // small labels
      ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--muted') || '#64748b';
      ctx.font = `${12*devicePixelRatio}px Inter, system-ui`;
      labels.forEach((lab,i)=>{
        const x = pad + (w-2*pad)*(i/(labels.length-1));
        ctx.fillText(lab, x-10*devicePixelRatio, h - 6*devicePixelRatio);
      });
    }

    // init
    load(); recompute(); render();

    // rerender when window resizes
    window.addEventListener('resize', ()=> drawChart());
  </script>
</body>
</html>
